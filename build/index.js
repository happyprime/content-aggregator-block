!function(e){var t={};function o(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=13)}([function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.wp.i18n},function(e,t){e.exports=window.wp.components},function(e,t){e.exports=window.wp.primitives},function(e,t){e.exports=window.wp.blocks},function(e,t){e.exports=window.wp.apiFetch},function(e,t){e.exports=window.wp.url},function(e,t){e.exports=window.wp.blockEditor},function(e,t){e.exports=window.wp.date},function(e,t){e.exports=window.wp.hooks},function(e,t,o){var n;!function(){"use strict";var o={}.hasOwnProperty;function a(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var l=typeof n;if("string"===l||"number"===l)e.push(n);else if(Array.isArray(n)){if(n.length){var c=a.apply(null,n);c&&e.push(c)}}else if("object"===l)if(n.toString===Object.prototype.toString)for(var r in n)o.call(n,r)&&n[r]&&e.push(r);else e.push(n.toString())}}return e.join(" ")}e.exports?(a.default=a,e.exports=a):void 0===(n=function(){return a}.apply(t,[]))||(e.exports=n)}()},function(e,t){e.exports=window.wp.data},function(e,t){e.exports=window.wp.htmlEntities},function(e,t,o){"use strict";o.r(t);var n=o(0),a=o(4),l=o(3),c=o(10),r=o.n(c),s=o(5),i=o.n(s),m=o(7),p=o(2),u=o(11),b=o(8),d=o(9),g=o(1),O=Object(n.createElement)(l.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Object(n.createElement)(l.Path,{d:"M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21ZM15.5303 8.46967C15.8232 8.76256 15.8232 9.23744 15.5303 9.53033L13.0607 12L15.5303 14.4697C15.8232 14.7626 15.8232 15.2374 15.5303 15.5303C15.2374 15.8232 14.7626 15.8232 14.4697 15.5303L12 13.0607L9.53033 15.5303C9.23744 15.8232 8.76256 15.8232 8.46967 15.5303C8.17678 15.2374 8.17678 14.7626 8.46967 14.4697L10.9393 12L8.46967 9.53033C8.17678 9.23744 8.17678 8.76256 8.46967 8.46967C8.76256 8.17678 9.23744 8.17678 9.53033 8.46967L12 10.9393L14.4697 8.46967C14.7626 8.17678 15.2374 8.17678 15.5303 8.46967Z"})),h=Object(n.createElement)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24"},Object(n.createElement)(l.Path,{d:"M10 1c-5 0-9 4-9 9s4 9 9 9 9-4 9-9-4-9-9-9zm0 16c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zm1-11H9v3H6v2h3v3h2v-3h3V9h-3V6zM10 1c-5 0-9 4-9 9s4 9 9 9 9-4 9-9-4-9-9-9zm0 16c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zm1-11H9v3H6v2h3v3h2v-3h3V9h-3V6z"})),j=Object(n.createElement)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24"},Object(n.createElement)(l.Path,{d:"M10.44 3.02l1.82-1.82 6.36 6.35-1.83 1.82c-1.05-.68-2.48-.57-3.41.36l-.75.75c-.92.93-1.04 2.35-.35 3.41l-1.83 1.82-2.41-2.41-2.8 2.79c-.42.42-3.38 2.71-3.8 2.29s1.86-3.39 2.28-3.81l2.79-2.79L4.1 9.36l1.83-1.82c1.05.69 2.48.57 3.4-.36l.75-.75c.93-.92 1.05-2.35.36-3.41z"})),y=Object(n.createElement)(l.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Object(n.createElement)(l.Path,{d:"M4 4v1.5h16V4H4zm8 8.5h8V11h-8v1.5zM4 20h16v-1.5H4V20zm4-8c0-1.1-.9-2-2-2s-2 .9-2 2 .9 2 2 2 2-.9 2-2z"})),_=Object(n.createElement)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(n.createElement)(l.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7.8 16.5H5c-.3 0-.5-.2-.5-.5v-6.2h6.8v6.7zm0-8.3H4.5V5c0-.3.2-.5.5-.5h6.2v6.7zm8.3 7.8c0 .3-.2.5-.5.5h-6.2v-6.8h6.8V19zm0-7.8h-6.8V4.5H19c.3 0 .5.2.5.5v6.2z",fillRule:"evenodd",clipRule:"evenodd"})),v=o(6),x=o(12);function f(e){const{onChange:t,selectedTerms:o,taxonomy:a}=e,[l,c]=Object(n.useState)([]),r=Object(n.useRef)(),s=a.split(",")[1];return Object(n.useEffect)(()=>(r.current=!0,i()({path:Object(v.addQueryArgs)("/wp/v2/"+s,{per_page:-1})}).then(e=>{if(r.current){const t=e.map(e=>({label:Object(x.decodeEntities)(e.name),value:e.id}));c(t)}}).catch(()=>{r.current&&c([])}),()=>{r.current=!1}),[a]),Object(n.createElement)(p.SelectControl,{className:"happyprime-block-cab_taxonomy-term-select",help:Object(g.__)("Ctrl/Cmd + click to select multiple terms"),label:Object(g.__)("Term(s)"),multiple:!0,onChange:t,options:l,value:o})}const w={per_page:-1},C={slug:"",terms:[],operator:"IN"};var E={from:[{type:"block",blocks:["core/latest-posts"],transform:e=>Object(a.createBlock)("happyprime/content-aggregator",{itemCount:e.postsToShow,order:e.order,orderBy:e.orderBy,displayPostDate:e.displayPostDate,postLayout:e.postLayout,columns:e.columns,displayPostContent:e.displayPostContent,postContent:e.displayPostContentRadio,excerptLength:e.excerptLength,displayImage:e.displayFeaturedImage,imageSize:e.featuredImageSizeSlug,stickyPosts:!1,addLinkToFeaturedImage:e.addLinkToFeaturedImage})},{type:"block",blocks:["happyprime/latest-custom-posts"],transform:e=>{const t=e.taxonomies&&0<e.taxonomies.length?e.taxonomies:e.customTaxonomy?"string"!=typeof e.customTaxonomy?e.customTaxonomy:[{slug:e.customTaxonomy,terms:[""+e.termID]}]:[];return Object(a.createBlock)("happyprime/content-aggregator",{customPostType:e.customPostType,taxonomies:t,taxRelation:e.taxRelation,itemCount:e.itemCount,order:e.order,orderBy:e.orderBy,displayPostDate:e.displayPostDate,postLayout:e.postLayout,columns:e.columns,displayPostContent:e.displayPostContent,postContent:e.postContent,excerptLength:e.excerptLength,displayImage:e.displayImage,imageSize:e.imageSize,stickyPosts:e.stickyPosts})}}]};Object(a.registerBlockType)("happyprime/content-aggregator",{icon:Object(n.createElement)(l.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Object(n.createElement)(l.Path,{d:"M11 7h6v2h-6zM11 11h6v2h-6zM11 15h6v2h-6zM7 7h2v2H7zM7 11h2v2H7zM7 15h2v2H7z"}),Object(n.createElement)(l.Path,{d:"M20.1 3H3.9c-.5 0-.9.4-.9.9v16.2c0 .4.4.9.9.9h16.2c.4 0 .9-.5.9-.9V3.9c0-.5-.5-.9-.9-.9zM19 19H5V5h14v14z"})),transforms:E,edit:function(e){const{attributes:t,setAttributes:o}=e,{itemCount:a,customPostType:l,taxonomies:c,taxRelation:s,order:x,orderBy:E,displayPostDate:k,postLayout:P,columns:S,displayPostContent:T,postContent:z,excerptLength:L,displayImage:M,imageSize:N,stickyPosts:A,addLinkToFeaturedImage:B}=t,R=l.split(",")[0],{postTypeOptions:I,taxonomyOptions:V,imageSizeOptions:H}=Object(u.useSelect)(e=>{const{getPostTypes:t,getTaxonomies:o}=e("core"),n=t(w),a=o(w),l=e("core/block-editor").getSettings().imageSizes,c=Object(d.applyFilters)("contentAggregatorBlock.ExcludePostTypes",["attachment"]),r=[],s=[],i=[];return n&&n.forEach(e=>{e.viewable&&e.rest_base&&!c.includes(e.slug)&&(r.push({label:e.labels.singular_name,value:e.slug}),R===e.slug&&e.taxonomies.length&&a&&(s.push({label:Object(g.__)("None"),value:""}),a.forEach(t=>{t.visibility.public&&e.taxonomies.includes(t.slug)&&s.push({label:t.name,value:t.slug+","+t.rest_base})})))}),l&&l.forEach(e=>{i.push({value:e.slug,label:e.name})}),{postTypeOptions:r,taxonomyOptions:s,imageSizeOptions:i}},[R]),[D,F]=Object(n.useState)(""),G=Object(n.useRef)();Object(n.useEffect)(()=>{G.current=!0;const e={post_type:R,per_page:a,order:x,orderby:E};if(cabStickyPostSupport.includes(R)&&A&&(e.sticky_posts=!0),c&&(e.taxonomies=c,s&&(e.tax_relation=s)),i()({path:Object(v.addQueryArgs)("/content-aggregator-block/v1/posts/",e)}).then(e=>{G.current&&F(e)}).catch(()=>{G.current&&F([])}),G.currrent&&(t.customTaxonomy||t.termID)){const e=[{slug:t.customTaxonomy,terms:[""+t.termID]}];o({taxonomies:e,customTaxonomy:void 0,termID:void 0})}return()=>{G.current=!1}},[a,x,E,R,A,c,s]);const Z=Array.isArray(D)&&D.length,q=Object(m.useBlockProps)({className:r()({"wp-block-latest-posts":!0,"happyprime-block-cab_error":!Z,"has-dates":k,"is-grid":"grid"===P,["columns-"+S]:"grid"===P})}),Q=(e,t,o)=>{let n;if(void 0!==c&&c.length&&(n=Object.values({...c,[e]:{...c[e],[t]:o}})),"slug"===t&&(void 0!==c&&c.length?o!==c[e].slug&&(n=Object.values({...n,[e]:{...n[e],terms:[],operator:void 0}})):n=[{slug:o,terms:[],operator:"IN"}]),"terms"===t){const t=!c[e].operator&&1<o.length?"IN":1<o.length?c[e].operator:void 0;n=Object.values({...n,[e]:{...n[e],operator:t}})}return n},$=(e,t)=>Object(n.createElement)("div",{className:"happyprime-block-cab_taxonomy-setting-wrapper"},0<t&&Object(n.createElement)(p.Button,{className:"happyprime-block-cab_taxonomy-remove-setting",icon:O,label:Object(g.__)("Remove taxonomy setting"),onClick:()=>{c.splice(t,1),o({taxonomies:[...c]}),1===c.length&&o({taxRelation:void 0})}}),Object(n.createElement)("div",{className:"happyprime-block-cab_taxonomy-setting"},Object(n.createElement)(p.SelectControl,{label:Object(g.__)("Taxonomy"),value:e.slug?e.slug:"",options:V,onChange:e=>{""===e?1===c.length?o({taxonomies:[]}):(c.splice(t,1),o({taxonomies:[...c]})):o({taxonomies:Q(t,"slug",e)})}}),""!==e.slug&&Object(n.createElement)(f,{onChange:e=>o({taxonomies:Q(t,"terms",e)}),selectedTerms:e.terms,taxonomy:e.slug}),e.terms&&1<e.terms.length&&Object(n.createElement)(p.RadioControl,{label:Object(g.__)("Show posts with:"),selected:e.operator,options:[{label:Object(g.__)("Any selected terms"),value:"IN"},{label:Object(g.__)("All selected terms"),value:"AND"}],onChange:e=>o({taxonomies:Q(t,"operator",e)})}))),U=Object(n.createElement)(m.InspectorControls,null,Object(n.createElement)(p.PanelBody,{title:Object(g.__)("Sorting and Filtering"),className:"panelbody-custom-latest-posts"},Object(n.createElement)(p.SelectControl,{key:"query-controls-order-select",label:Object(g.__)("Order by"),value:`${E}/${x}`,options:[{label:Object(g.__)("Newest to Oldest"),value:"date/desc"},{label:Object(g.__)("Oldest to Newest"),value:"date/asc"},{label:Object(g.__)("A → Z"),value:"title/asc"},{label:Object(g.__)("Z → A"),value:"title/desc"},{label:Object(g.__)("Random"),value:"rand/desc"}],onChange:e=>{const[t,n]=e.split("/"),a={};n!==x&&(a.order=n),t!==E&&(a.orderBy=t),(a.order||a.orderBy)&&o(a)}}),Object(n.createElement)(p.RangeControl,{label:Object(g.__)("Number of items"),value:a,onChange:e=>{o({itemCount:Number(e)})},min:1,max:100}),Object(n.createElement)(p.SelectControl,{label:Object(g.__)("Post Type"),value:l,options:I,onChange:e=>{o({customPostType:e,taxonomies:[]})}}),cabStickyPostSupport.includes(l.split(",")[0])&&"date"===E&&Object(n.createElement)(p.ToggleControl,{label:Object(g.__)("Show sticky posts at the start of the set"),checked:A,onChange:e=>{o({stickyPosts:e})}}),Object(n.createElement)("div",{className:"happyprime-block-cab_taxonomy-settings"},Object(n.createElement)("p",null,Object(g.__)("Taxonomy Settings")),c&&0<c.length?c.map((e,t)=>$(e,t)):$(C,0),c&&0<c.length&&c[0].terms&&0<c[0].terms.length&&Object(n.createElement)(p.Button,{className:"happyprime-block-cab_taxonomy-add-setting",icon:h,label:Object(g.__)("Add more taxonomy settings"),onClick:()=>{o({taxonomies:c.concat(C)}),s||o({taxRelation:"AND"})},text:Object(g.__)("Add more taxonomy settings")}),c&&1<c.length&&Object(n.createElement)(p.RadioControl,{className:"happyprime-block-cab_taxonomy-relation",label:Object(g.__)("Taxonomy Relation"),selected:s,options:[{label:Object(g.__)("And"),value:"AND"},{label:Object(g.__)("Or"),value:"OR"}],onChange:e=>o({taxRelation:e})})),"grid"===P&&Object(n.createElement)(p.RangeControl,{label:Object(g.__)("Columns"),value:S,onChange:e=>o({columns:e}),min:2,max:Z?Math.min(6,D.length):6,required:!0})),Object(n.createElement)(p.PanelBody,{title:Object(g.__)("Post Content Settings"),className:"panelbody-custom-latest-posts"},Object(n.createElement)(p.ToggleControl,{label:Object(g.__)("Display post date"),checked:k,onChange:e=>o({displayPostDate:e})}),Object(n.createElement)(p.ToggleControl,{label:Object(g.__)("Display post content"),checked:T,onChange:e=>o({displayPostContent:e})}),T&&Object(n.createElement)(p.RadioControl,{label:Object(g.__)("Show"),selected:z,options:[{label:Object(g.__)("Excerpt"),value:"excerpt"},{label:Object(g.__)("Full Post"),value:"full_post"}],onChange:e=>o({postContent:e})}),T&&"excerpt"===z&&Object(n.createElement)(p.RangeControl,{label:Object(g.__)("Max number of words in excerpt"),value:L,onChange:e=>o({excerptLength:e}),min:10,max:100}),Object(n.createElement)(p.ToggleControl,{label:Object(g.__)("Display featured image"),checked:M,onChange:e=>o({displayImage:e})}),M&&Object(n.createElement)(n.Fragment,null,Object(n.createElement)(p.SelectControl,{label:Object(g.__)("Image size"),onChange:e=>o({imageSize:e}),options:H,value:N}),Object(n.createElement)(p.ToggleControl,{label:Object(g.__)("Add link to featured image"),checked:B,onChange:e=>o({addLinkToFeaturedImage:e})}))));if(!Z)return Object(n.createElement)("div",q,U,Object(n.createElement)(p.Placeholder,{icon:j,label:Object(g.__)("Content Aggregator")},Array.isArray(D)?Object(g.__)("No current items."):Object(n.createElement)(p.Spinner,null)));const J=D.length>a?D.slice(0,a):D;return Object(n.createElement)(n.Fragment,null,U,Object(n.createElement)(m.BlockControls,null,Object(n.createElement)(p.ToolbarGroup,{controls:[{icon:y,title:Object(g.__)("List View"),onClick:()=>o({postLayout:"list"}),isActive:"list"===P},{icon:_,title:Object(g.__)("Grid View"),onClick:()=>o({postLayout:"grid"}),isActive:"grid"===P}]})),Object(n.createElement)("ul",q,J.map(e=>(e=>{const o=e.title.trim(),a=document.createElement("div");a.innerHTML=e.excerpt;const l=a.textContent||a.innerText||"",c=Object(n.createElement)("li",null,Object(n.createElement)(p.Disabled,null,Object(n.createElement)("a",{href:e.link,rel:"noreferrer noopener"},o?Object(n.createElement)(n.RawHTML,null,o):Object(g.__)("(Untitled)"))),k&&e.date_gmt&&Object(n.createElement)("time",{dateTime:Object(b.format)("c",e.date_gmt),className:"wp-block-latest-posts__post-date"},Object(b.dateI18n)(Object(b.__experimentalGetSettings)().formats.date,e.date_gmt)),M&&e.image[N]&&Object(n.createElement)("figure",{className:"wp-block-latest-posts__post-thumbnail"},B?Object(n.createElement)(p.Disabled,null,Object(n.createElement)("a",{href:e.link,rel:"noreferrer noopener"},Object(n.createElement)("img",{src:e.image[N],alt:""}))):Object(n.createElement)("img",{src:e.image[N],alt:""})),T&&"excerpt"===z&&Object(n.createElement)("div",{className:"wp-block-latest-posts__post-excerpt"},Object(n.createElement)(n.RawHTML,{key:"html"},L<l.trim().split(" ").length?l.trim().split(" ",L).join(" ")+"…":l.trim().split(" ",L).join(" "))),T&&"full_post"===z&&Object(n.createElement)("div",{className:"wp-block-latest-posts__post-full-content"},Object(n.createElement)(n.RawHTML,{key:"html"},e.content.trim())));return Object(d.applyFilters)("contentAggregatorBlock.itemHTML",c,e,t)})(e))))}})}]);